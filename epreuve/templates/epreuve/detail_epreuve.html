{% extends 'olympiadesnsi/base_participant.html' %}

{% block content %}
    <div class="container mt-4">
        <h1>{{ epreuve.nom }}</h1>

        <div class="mb-3">
            <strong>Date de d√©but :</strong> {{ epreuve.date_debut|date:"d M Y" }}<br>
            <strong>Date de fin :</strong> {{ epreuve.date_fin|date:"d M Y" }}
        </div>

        {% if epreuve.temps_limite %}
            <div class="alert alert-info">
                Cette √©preuve est √† dur√©e limit√©e.
                <strong>Dur√©e :</strong> {{ epreuve.duree }} minutes.
                Le chronom√®tre d√©marrera lorsque vous aurez cliqu√© sur "D√©marrer l'√©preuve".
            </div>
        {% else %}
            <div class="alert alert-success">
                Il n'y a pas de limite de temps pour cette √©preuve.
            </div>
        {% endif %}

        {% if epreuve.exercices_un_par_un %}
            <div class="alert alert-warning">
                Les exercices doivent √™tre trait√©s un par un.
            </div>
        {% else %}
            <div class="alert alert-secondary">
                Vous pouvez traiter les exercices dans l'ordre de votre choix.
            </div>
        {% endif %}

        {% if indication_utilisateurs_retour > 0 %}
            <div class="alert alert-info shadow-sm border rounded p-3">
                <p>
                    <strong>üîé Pour {{ indication_utilisateurs_retour }} exercice(s), vous avez un retour en
                        direct</strong>
                    sur la r√©ponse au jeu de test que vous enregistrez.
                </p>

                <ul class="list-unstyled">
                    <li>
                        <i class="indic-exo-valide fa-regular fa-circle-check fa-lg" style="color:green;"></i>
                        <strong> R√©ponse correcte avec code enregistr√© :</strong> votre r√©ponse au jeu de test est valide
                        et un code a bien √©t√© enregistr√©.
                        Pensez √† v√©rifier que le code soumis est bien celui qui a g√©n√©r√© la r√©ponse.

                    </li>
                    <li>
                        <i class="indic-exo-code-manquant fa-regular fa-pencil fa-lg" style="color:orange;"></i>
                        <strong> R√©ponse correcte mais code manquant :</strong> attention, votre r√©ponse est correcte
                        mais aucun code n‚Äôa √©t√© soumis.
                    </li>
                    <li>
                        <i class="indic-exo-invalide fa-regular fa-circle-xmark fa-lg" style="color:red;"></i>
                        <strong> R√©ponse incorrecte :</strong> votre code n‚Äôa pas produit la bonne r√©ponse.
                    </li>
                    <li>
                        <i class="indic-exo-non-soumis fa-regular fa-circle-question fa-lg" style="color:gray;"></i>
                        <strong> Exercice non soumis ou pas de v√©rification:</strong> Soit aucune r√©ponse n‚Äôa √©t√© enregistr√©e, soit aucune v√©rification n'est pr√©vue pour cet exercice.
                    </li>
                </ul>

                <p class="mt-3">
                    <i class="fa-solid fa-triangle-exclamation fa-lg text-warning"></i>
                    <strong> Attention :</strong> assurez-vous que le code soumis correspond bien √† la version ayant
                    g√©n√©r√© la r√©ponse valid√©e.
                </p>
            </div>
        {% endif %}

        {% if epreuve.doit_demander_identifiants %}
            <p>Merci de renseigner votre situation concernant l'√©preuve th√©orique :</p>

            <form method="POST">
                {% csrf_token %}
                {% for i in "123"|make_list %}
                    <div class="form-group">
                        <label>Participant {{ i }} :</label><br>

                        <input type="radio" name="choix_{{ i }}" value="1" id="choix_{{ i }}_1"
                               {% if anonymats|slice:i|last != "?" and anonymats|slice:i|last != "-" %}checked{% endif %}
                               onchange="toggleInput({{ i }})">
                        <label for="choix_{{ i }}_1">J'ai particip√© et j'ai mon num√©ro d'anonymat</label><br>

                        <input type="radio" name="choix_{{ i }}" value="2" id="choix_{{ i }}_2"
                               {% if anonymats|slice:i|last == "?" %}checked{% endif %}
                               onchange="toggleInput({{ i }})">
                        <label for="choix_{{ i }}_2">J'ai particip√© mais je n'ai pas mon num√©ro</label><br>

                        <input type="radio" name="choix_{{ i }}" value="3" id="choix_{{ i }}_3"
                               {% if anonymats|slice:i|last == "-" %}checked{% endif %}
                               onchange="toggleInput({{ i }})">
                        <label for="choix_{{ i }}_3">Je n'ai pas particip√©</label><br>

                        <input type="text" class="form-control anonymat" id="anonymat_{{ i }}" name="anonymat_{{ i }}"
                               value="
                                       {% if anonymats|slice:i|last != "?" and anonymats|slice:i|last != "-" %}{{ anonymats|slice:i|last }}{% endif %}"
                               {% if anonymats|slice:i|last == "?" or anonymats|slice:i|last == "-" %}style="display:none;"{% endif %}
                               placeholder="Entrez votre num√©ro d'anonymat">
                    </div>
                {% endfor %}
                <button type="submit" class="btn btn-primary mt-3">Enregistrer</button>
            </form>
        {% else %}
            <a href="{% url 'afficher_epreuve' epreuve.id %}" class="btn btn-primary">D√©marrer l'√©preuve</a>
        {% endif %}

    </div>

    <script>
        function toggleInput(index) {
            const choix1 = document.getElementById(`choix_${index}_1`);
            const input = document.getElementById(`anonymat_${index}`);

            if (choix1.checked) {
                input.style.display = "block"; // Afficher l'input si choix 1
            } else {
                input.style.display = "none";  // Masquer sinon
                input.value = ""; // R√©initialiser l'input si masqu√©
            }
        }
    </script>

{% endblock %}
